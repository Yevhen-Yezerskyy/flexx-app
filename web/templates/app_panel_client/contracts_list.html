{% extends "app_panel_client/base.html" %}

{% block panel_where %}Meine Verträge{% endblock %}
{% block nav_my_contracts_class %}text-[var(--accent)] font-semibold{% endblock %}

{% block panel_content %}
<div class="flex items-center mb-10 mt-2">
  <div class="text-2xl">Meine Verträge</div>
  <div class="flex-1"></div>
  <a href="{% url 'panel_client_contract_create' %}"
     class="w-56 rounded-md bg-[var(--accent)] text-white py-3 hover:brightness-110 transition font-semibold text-center flex items-center justify-center">
    Vertrag hinzufügen
  </a>
</div>

<div class="bg-white border border-gray-400 rounded-md overflow-hidden">
  <table class="w-full text-sm">
    <thead class="bg-gray-100">
      <tr class="text-left">
        <th class="px-4 py-3 w-[35%] text-[var(--accent)] font-semibold">Daten zur Emission</th>
        <th class="px-4 py-3 w-[35%] text-[var(--accent)] font-semibold">Daten zum Vertrag</th>
        <th class="px-4 py-3 w-[25%] text-[var(--accent)] font-semibold">Status</th>
        <th class="px-4 py-3 text-[var(--accent)] font-semibold">&nbsp;</th>
      </tr>
    </thead>
    <tbody>
      {% for c in contracts %}
        <tr class="border-t border-gray-200 align-top">
          <td class="px-4 py-3">
            <div class="grid grid-cols-[150px_minmax(0,1fr)] gap-x-2 gap-y-2">
              <div class="font-semibold col-span-2">{{ c.issue.title }}</div>
              <div>Ausgabedatum:</div><div>{{ c.issue.issue_date|date:"d.m.Y" }}</div>
              <div>Zinssatz:</div><div>{{ c.issue.interest_rate }}%</div>
              <div>Laufzeit:</div><div>{{ c.issue.term_months }} Monate</div>
              <div>Preis pro Anleihe, €:</div><div>{{ c.issue_bond_price_display }}</div>
              <div>Volumen, €:</div><div>{{ c.issue_volume_display }}</div>
            </div>
          </td>
          <td class="px-4 py-3">
            <div class="grid grid-cols-[150px_minmax(0,1fr)] gap-x-2 gap-y-2">
              <div class="col-span-2">
                {% if c.contract_pdf %}
                  <b>Vertrag: <a class="underline hover:text-[var(--accent)] transition" href="{{ c.contract_pdf.url }}" title="{{ c.pdf_basename }}"></b>
                    {{ c.pdf_basename }}
                  </a>
                {% else %}
                  <span class="text-gray-500">Vertrag nicht erstellt</span>
                {% endif %}
              </div>
              <div>Unterzeichnet am:</div>
              <div class="font-semibold">{{ c.contract_date|date:"d.m.Y" }}</div>
              <div>Zahlungsfrist bis:</div>
              <div class="font-semibold">{% if c.settlement_date %}{{ c.settlement_date|date:"d.m.Y" }}{% else %}—{% endif %}</div>
              <div>Anzahl:</div>
              <div>{% if c.bonds_quantity is not None %}{{ c.bonds_quantity_display }}{% else %}—{% endif %}</div>
              <div>Nominal, €:</div>
              <div>{% if c.nominal_amount is not None %}{{ c.nominal_amount_display }}{% else %}—{% endif %}</div>
              <div>Nominal + %, €:</div>
              <div>{% if c.nominal_amount_plus_percent is not None %}{{ c.nominal_amount_plus_percent_display }}{% else %}—{% endif %}</div>
            </div>
          </td>
          <td class="px-4 py-3">
            <div class="grid grid-cols-[80px_1fr] gap-x-2 gap-y-1">
              <div>Erhalten:</div>
              <div>
                {% if c.signed_received_at %}
                  Ja ({{ c.signed_received_at|date:"d.m.Y" }})
                {% else %}
                  Nein
                {% endif %}
              </div>
              <div>Bezahlt:</div>
              <div>
                {% if c.paid_at %}
                  Ja ({{ c.paid_at|date:"d.m.Y" }})
                {% else %}
                  Nein
                {% endif %}
              </div>
            </div>
          </td>
          <td class="px-4 py-3 whitespace-nowrap">
            {% if c.is_editable %}
              <a class="underline hover:text-[var(--accent)] transition"
                 href="{% url 'panel_client_contract_edit' c.id %}">Ändern</a><br>
              <form method="post"
                    action="{% url 'panel_client_contract_delete' c.id %}"
                    onsubmit="return confirm('Wirklich löschen?');">
                {% csrf_token %}
                <button type="submit" class="underline hover:text-red-600 transition mt-1">
                  Löschen
                </button>
              </form>
            {% else %}
              <span class="text-gray-500">Änderung<br> nicht möglich</span>
            {% endif %}
          </td>
        </tr>
      {% empty %}
        <tr>
          <td class="px-4 py-10 text-gray-500" colspan="5">Noch keine Verträge.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="mt-6 bg-white border border-gray-400 rounded-md px-7 py-5">
  <div>
    Laden Sie den Vertrag herunter, drucken Sie ihn aus und senden Sie ihn per Post.
  </div>
  <div class="mt-2">
    Wenn die von Ihnen gewählte Emission für Sie nicht geeignet ist, können Sie diesen Vertrag löschen (sofern der Vertrag noch nicht per Post bei uns eingegangen ist und keine Zahlung erfolgt ist) und einen neuen Vertrag erstellen.
  </div>
</div>
{% endblock %}
