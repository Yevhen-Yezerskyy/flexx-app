{% extends "app_panel_admin/base.html" %}
<!-- FILE: web/templates/app_panel_admin/contracts_list.html  (новое — 2026-02-16)
     PURPOSE: Admin: список всех Verträge со всеми полями + ссылки на PDF и редактирование. -->
{% block panel_where %}Verträge{% endblock %}
{% block nav_contracts_class %}text-[var(--accent)] font-semibold{% endblock %}

{% block panel_content %}

<div class="flex items-center mb-10 mt-2">
  <div class="text-2xl">Verträge</div>
  <div class="flex-1"></div>
</div>

<div class="bg-white border border-[var(--text)] rounded-md overflow-hidden">
  <table class="w-full text-sm">
    <thead class="bg-gray-50">
      <tr class="text-left">
        <th class="px-4 py-3 w-[18%]">Datum</th>
        <th class="px-4 py-3 w-[22%]">Kunde</th>
        <th class="px-4 py-3 w-[20%]">Emission</th>
        <th class="px-4 py-3 w-[25%]">Daten</th>
        <th class="px-4 py-3">&nbsp;</th>
      </tr>
    </thead>

    <tbody>
      {% for c in contracts %}
        <tr class="border-t border-gray-200 align-top">
          <td class="px-4 py-3">
            <div class="font-semibold">{{ c.contract_date|date:"d.m.Y" }}</div>
            {% if c.settlement_date %}
              <div class="text-xs text-gray-600">Valuta: {{ c.settlement_date|date:"d.m.Y" }}</div>
            {% endif %}
          </td>

          <td class="px-4 py-3">
            <div class="font-semibold">{{ c.client.first_name }} {{ c.client.last_name }}</div>
            <div class="text-xs text-gray-600">{{ c.client.email }}</div>
          </td>

          <td class="px-4 py-3">
            <div class="font-semibold">{{ c.issue.title }}</div>
            <div class="text-xs text-gray-600">{{ c.issue.issue_date|date:"d.m.Y" }}</div>
          </td>

          <td class="px-4 py-3">
            <div class="grid grid-cols-2 gap-1">
              <div>Anzahl:</div>
              <div>{% if c.bonds_quantity %}{{ c.bonds_quantity }}{% else %}—{% endif %}</div>

              <div>Nominal:</div>
              <div>{% if c.nominal_amount %}{{ c.nominal_amount }}{% else %}—{% endif %}</div>

              <div>Nominal + %:</div>
              <div>{% if c.nominal_amount_plus_percent %}{{ c.nominal_amount_plus_percent }}{% else %}—{% endif %}</div>

              <div>Signed:</div>
              <div>{% if c.signed_received_at %}{{ c.signed_received_at|date:"d.m.Y" }}{% else %}—{% endif %}</div>

              <div>Paid:</div>
              <div>{% if c.paid_at %}{{ c.paid_at|date:"d.m.Y" }}{% else %}—{% endif %}</div>
            </div>

            <div class="mt-2">
              {% if c.pdf_file %}
                <a class="underline hover:text-[var(--accent)] transition" href="{{ c.pdf_file.url }}">
                  {{ c.pdf_file.name }}
                </a>
              {% else %}
                <span class="text-red-600">Vertrag nicht erstellt</span>
              {% endif %}
            </div>
          </td>

          <td class="px-4 py-3 whitespace-nowrap">
            <a class="underline hover:text-[var(--accent)] transition"
               href="{% url 'panel_admin_contract_edit' c.id %}">Öffnen</a>
          </td>
        </tr>

      {% empty %}
        <tr>
          <td class="px-4 py-10 text-gray-500" colspan="5">Noch keine Verträge.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
