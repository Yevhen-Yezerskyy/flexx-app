{% extends "app_panel_admin/base.html" %}
<!-- FILE: web/templates/app_panel_admin/contract_edit.html  (обновлено — 2026-02-16)
     PURPOSE: Admin: страница контракта + печать таблицы Stückzinsen по дням (4 колонки, выходные/праздники). -->
{% block panel_where %}Vertrag bearbeiten{% endblock %}

{% block panel_content %}

<div class="flex items-center mb-8 mt-2">
  <div class="text-2xl">Vertrag #{{ contract.id }}</div>
  <div class="flex-1"></div>
  <a href="{% url 'panel_admin_clients' %}" class="underline hover:text-[var(--accent)] transition">Zurück</a>
</div>

<div class="bg-white border border-[var(--text)] rounded-md px-7 py-5 flex flex-col gap-4">
  <div class="grid grid-cols-2 gap-4">
    <div>
      <div class="text-sm text-gray-600">Kunde</div>
      <div class="font-semibold">{{ contract.client.first_name }} {{ contract.client.last_name }}</div>
      <div class="text-sm text-gray-600">{{ contract.client.email }}</div>
    </div>

    <div>
      <div class="text-sm text-gray-600">Emission</div>
      <div class="font-semibold">{{ contract.issue.title }}</div>
      <div class="text-sm text-gray-600">{{ contract.issue.issue_date }}</div>
    </div>
  </div>

  <div class="grid grid-cols-3 gap-4 pt-2">
    <div>
      <div class="text-sm text-gray-600">Vertragsdatum</div>
      <div class="font-semibold">{{ contract.contract_date }}</div>
    </div>
    <div>
      <div class="text-sm text-gray-600">Unterschrieben erhalten</div>
      <div class="font-semibold">{% if contract.signed_received_at %}{{ contract.signed_received_at }}{% else %}-{% endif %}</div>
    </div>
    <div>
      <div class="text-sm text-gray-600">Bezahlt</div>
      <div class="font-semibold">{% if contract.paid_at %}{{ contract.paid_at }}{% else %}-{% endif %}</div>
    </div>
  </div>
</div>

<div class="mt-6 bg-white border border-[var(--text)] rounded-md px-7 py-5">
  <div class="text-lg font-semibold mb-4">Stückzinstabelle (je 1,00 EUR)</div>

  <div class="grid grid-cols-4 gap-4">
    {% for col in stueckzins_cols %}
      <table class="w-full border border-[var(--text)] text-sm">
        <thead>
          <tr>
            <th class="border border-[var(--text)] px-2 py-2 text-center font-semibold">
              Stückzinsen je Teilschuld-<br>verschreibung zu EUR 1,00<br>in EUR
            </th>
            <th class="border border-[var(--text)] px-2 py-2 text-center font-semibold">
              Datum der Einzahlung
            </th>
          </tr>
        </thead>
        <tbody>
          {% for r in col %}
            <tr class="{% if r.is_holiday %}bg-gray-200{% elif r.is_weekend %}bg-gray-100{% endif %}">
              <td class="border border-[var(--text)] px-2 py-1 text-center">
                {{ r.stueckzins_de }}
              </td>
              <td class="border border-[var(--text)] px-2 py-1 text-center">
                {{ r.pay_date|date:"d. M y" }}
                {% if r.is_holiday %}
                  <span class="ml-1 text-xs">(Feiertag)</span>
                {% elif r.is_weekend %}
                  <span class="ml-1 text-xs">(WE)</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endfor %}
  </div>

  <div class="text-xs text-gray-600 mt-3">
    Markierung: WE = Wochenende, Feiertag = gesetzlicher Feiertag (DE).
  </div>
</div>

{% endblock %}
